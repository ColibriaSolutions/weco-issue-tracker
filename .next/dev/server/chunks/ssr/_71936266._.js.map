{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///G:/SourceCode/WECORelated/weco-issue-tracker/app/actions/project-actions.ts"],"sourcesContent":["'use server'\r\n\r\nimport { createServerClient } from '@/lib/supabase/server'\r\nimport { revalidatePath } from 'next/cache'\r\n\r\nexport async function createProject({\r\n  name,\r\n  description,\r\n}: {\r\n  name: string\r\n  description: string\r\n}) {\r\n  try {\r\n    const supabase = await createServerClient()\r\n\r\n    // Get current user\r\n    const { data: { user }, error: authError } = await supabase.auth.getUser()\r\n    if (authError || !user) {\r\n      return { error: 'You must be logged in to create a project' }\r\n    }\r\n\r\n    // Create project with owner\r\n    const { data, error } = await supabase\r\n      .from('projects')\r\n      .insert([\r\n        {\r\n          name,\r\n          description,\r\n          owner_id: user.id,\r\n        },\r\n      ])\r\n      .select()\r\n      .single()\r\n\r\n    if (error) {\r\n      console.error('[v0] Error creating project:', error)\r\n      return { error: error.message }\r\n    }\r\n\r\n    // Add owner to project_members\r\n    const { error: memberError } = await supabase\r\n      .from('project_members')\r\n      .insert({\r\n        project_id: data.id,\r\n        user_id: user.id,\r\n        role: 'owner',\r\n      })\r\n\r\n    if (memberError) {\r\n      console.error('[v0] Error adding owner to project_members:', memberError)\r\n      // Don't fail the whole operation, just log it\r\n    }\r\n\r\n    revalidatePath('/')\r\n    return { data }\r\n  } catch (error) {\r\n    console.error('[v0] Error creating project:', error)\r\n    return { error: 'Failed to create project' }\r\n  }\r\n}\r\n\r\nexport async function deleteProject(projectId: string) {\r\n  try {\r\n    const supabase = await createServerClient()\r\n\r\n    // Check if user is authenticated\r\n    const { data: { user }, error: authError } = await supabase.auth.getUser()\r\n    if (authError || !user) {\r\n      return { error: 'You must be logged in' }\r\n    }\r\n\r\n    // Get user's role and check if they're the project owner\r\n    const { data: profile, error: profileError } = await supabase\r\n      .from('profiles')\r\n      .select('role')\r\n      .eq('id', user.id)\r\n      .single()\r\n\r\n    if (profileError || !profile) {\r\n      return { error: 'Failed to verify permissions' }\r\n    }\r\n\r\n    // Check if user is admin or project owner\r\n    const isAdmin = profile.role === 'admin'\r\n\r\n    if (!isAdmin) {\r\n      // Check if user is project owner\r\n      const { data: project } = await supabase\r\n        .from('projects')\r\n        .select('owner_id')\r\n        .eq('id', projectId)\r\n        .single()\r\n\r\n      if (!project || project.owner_id !== user.id) {\r\n        return { error: 'Only project owners and administrators can delete projects' }\r\n      }\r\n    }\r\n\r\n    // Delete the project (cascade will handle issues, comments, and members)\r\n    const { error } = await supabase\r\n      .from('projects')\r\n      .delete()\r\n      .eq('id', projectId)\r\n\r\n    if (error) {\r\n      console.error('[v0] Error deleting project:', error)\r\n      return { error: error.message }\r\n    }\r\n\r\n    revalidatePath('/')\r\n    return { success: true }\r\n  } catch (error) {\r\n    console.error('[v0] Error deleting project:', error)\r\n    return { error: 'Failed to delete project' }\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;AAEA;AACA;;;;;AAEO,eAAe,cAAc,EAClC,IAAI,EACJ,WAAW,EAIZ;IACC,IAAI;QACF,MAAM,WAAW,MAAM,IAAA,+IAAkB;QAEzC,mBAAmB;QACnB,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,OAAO,SAAS,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;QACxE,IAAI,aAAa,CAAC,MAAM;YACtB,OAAO;gBAAE,OAAO;YAA4C;QAC9D;QAEA,4BAA4B;QAC5B,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,YACL,MAAM,CAAC;YACN;gBACE;gBACA;gBACA,UAAU,KAAK,EAAE;YACnB;SACD,EACA,MAAM,GACN,MAAM;QAET,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,gCAAgC;YAC9C,OAAO;gBAAE,OAAO,MAAM,OAAO;YAAC;QAChC;QAEA,+BAA+B;QAC/B,MAAM,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,SAClC,IAAI,CAAC,mBACL,MAAM,CAAC;YACN,YAAY,KAAK,EAAE;YACnB,SAAS,KAAK,EAAE;YAChB,MAAM;QACR;QAEF,IAAI,aAAa;YACf,QAAQ,KAAK,CAAC,+CAA+C;QAC7D,8CAA8C;QAChD;QAEA,IAAA,8QAAc,EAAC;QACf,OAAO;YAAE;QAAK;IAChB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,OAAO;YAAE,OAAO;QAA2B;IAC7C;AACF;AAEO,eAAe,cAAc,SAAiB;IACnD,IAAI;QACF,MAAM,WAAW,MAAM,IAAA,+IAAkB;QAEzC,iCAAiC;QACjC,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,OAAO,SAAS,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;QACxE,IAAI,aAAa,CAAC,MAAM;YACtB,OAAO;gBAAE,OAAO;YAAwB;QAC1C;QAEA,yDAAyD;QACzD,MAAM,EAAE,MAAM,OAAO,EAAE,OAAO,YAAY,EAAE,GAAG,MAAM,SAClD,IAAI,CAAC,YACL,MAAM,CAAC,QACP,EAAE,CAAC,MAAM,KAAK,EAAE,EAChB,MAAM;QAET,IAAI,gBAAgB,CAAC,SAAS;YAC5B,OAAO;gBAAE,OAAO;YAA+B;QACjD;QAEA,0CAA0C;QAC1C,MAAM,UAAU,QAAQ,IAAI,KAAK;QAEjC,IAAI,CAAC,SAAS;YACZ,iCAAiC;YACjC,MAAM,EAAE,MAAM,OAAO,EAAE,GAAG,MAAM,SAC7B,IAAI,CAAC,YACL,MAAM,CAAC,YACP,EAAE,CAAC,MAAM,WACT,MAAM;YAET,IAAI,CAAC,WAAW,QAAQ,QAAQ,KAAK,KAAK,EAAE,EAAE;gBAC5C,OAAO;oBAAE,OAAO;gBAA6D;YAC/E;QACF;QAEA,yEAAyE;QACzE,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SACrB,IAAI,CAAC,YACL,MAAM,GACN,EAAE,CAAC,MAAM;QAEZ,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,gCAAgC;YAC9C,OAAO;gBAAE,OAAO,MAAM,OAAO;YAAC;QAChC;QAEA,IAAA,8QAAc,EAAC;QACf,OAAO;YAAE,SAAS;QAAK;IACzB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,OAAO;YAAE,OAAO;QAA2B;IAC7C;AACF;;;IA9GsB;IAwDA;;AAxDA,8WAAA;AAwDA,8WAAA"}},
    {"offset": {"line": 120, "column": 0}, "map": {"version":3,"sources":["file:///G:/SourceCode/WECORelated/weco-issue-tracker/.next-internal/server/app/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {logout as '00478dc19c25d68685b5311d665bfb9fe6b61edb59'} from 'ACTIONS_MODULE0'\nexport {signup as '407b8a3154c7a0c34448a3ca2e7ebad839bad6ded1'} from 'ACTIONS_MODULE0'\nexport {login as '40ce5fd73ec76a24efd689a60e920e004537f4ca8c'} from 'ACTIONS_MODULE0'\nexport {createProject as '409344f94d1dd928489cff6ade08ce46bc15e5d505'} from 'ACTIONS_MODULE1'\nexport {deleteProject as '40823ee5702cd64a2342baa2ec904704290d1ff493'} from 'ACTIONS_MODULE1'\n"],"names":[],"mappings":";AAAA;AAGA"}}]
}